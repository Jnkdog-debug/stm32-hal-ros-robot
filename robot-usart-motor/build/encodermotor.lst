ARM GAS  /tmp/ccykVCxp.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"encodermotor.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "EncoderMotor/encodermotor.c"
  20              		.section	.text.Motor_Init,"ax",%progbits
  21              		.align	1
  22              		.global	Motor_Init
  23              		.syntax unified
  24              		.thumb
  25              		.thumb_func
  27              	Motor_Init:
  28              	.LVL0:
  29              	.LFB134:
   1:EncoderMotor/encodermotor.c **** #include "encodermotor.h"
   2:EncoderMotor/encodermotor.c **** #include <stdint.h>
   3:EncoderMotor/encodermotor.c **** 
   4:EncoderMotor/encodermotor.c **** 
   5:EncoderMotor/encodermotor.c **** 
   6:EncoderMotor/encodermotor.c **** MotorControl_t Motor_A = {
   7:EncoderMotor/encodermotor.c ****     .pwm_timo1 = &htim10,
   8:EncoderMotor/encodermotor.c ****     .pwm_channel1 = TIM_CHANNEL_1,
   9:EncoderMotor/encodermotor.c ****     .pwm_timo2 = &htim11,
  10:EncoderMotor/encodermotor.c ****     .pwm_channel2 = TIM_CHANNEL_1,
  11:EncoderMotor/encodermotor.c ****     .encoder_tim = &htim2,
  12:EncoderMotor/encodermotor.c ****     .kp = 0.5f,
  13:EncoderMotor/encodermotor.c ****     .ki = 0.2f,
  14:EncoderMotor/encodermotor.c ****     .kd = 0.05f
  15:EncoderMotor/encodermotor.c **** };
  16:EncoderMotor/encodermotor.c **** 
  17:EncoderMotor/encodermotor.c **** 
  18:EncoderMotor/encodermotor.c **** // 电机 B: PWM (TIM9_CH1/CH2), 编码器 (TIM3)
  19:EncoderMotor/encodermotor.c **** MotorControl_t Motor_B = {
  20:EncoderMotor/encodermotor.c ****     .pwm_timo1 = &htim9, 
  21:EncoderMotor/encodermotor.c ****     .pwm_channel1 = TIM_CHANNEL_1,
  22:EncoderMotor/encodermotor.c ****     .pwm_timo2 = &htim9, 
  23:EncoderMotor/encodermotor.c ****     .pwm_channel2 = TIM_CHANNEL_2,
  24:EncoderMotor/encodermotor.c ****     .encoder_tim = &htim3, 
  25:EncoderMotor/encodermotor.c ****     .kp = 0.5f,
  26:EncoderMotor/encodermotor.c ****     .ki = 0.2f,
  27:EncoderMotor/encodermotor.c ****     .kd = 0.05f
  28:EncoderMotor/encodermotor.c **** };
  29:EncoderMotor/encodermotor.c **** 
ARM GAS  /tmp/ccykVCxp.s 			page 2


  30:EncoderMotor/encodermotor.c **** // 电机 C: PWM (TIM1_CH1/CH2), 编码器 (TIM4)
  31:EncoderMotor/encodermotor.c **** MotorControl_t Motor_C = {
  32:EncoderMotor/encodermotor.c ****     .pwm_timo1 = &htim1, 
  33:EncoderMotor/encodermotor.c ****     .pwm_channel1 = TIM_CHANNEL_1,
  34:EncoderMotor/encodermotor.c ****     .pwm_timo2 = &htim1, 
  35:EncoderMotor/encodermotor.c ****     .pwm_channel2 = TIM_CHANNEL_2,
  36:EncoderMotor/encodermotor.c ****     .encoder_tim = &htim4, 
  37:EncoderMotor/encodermotor.c ****     .kp = 0.5f,
  38:EncoderMotor/encodermotor.c ****     .ki = 0.2f,
  39:EncoderMotor/encodermotor.c ****     .kd = 0.05f
  40:EncoderMotor/encodermotor.c **** };
  41:EncoderMotor/encodermotor.c **** 
  42:EncoderMotor/encodermotor.c **** // 电机 D: PWM (TIM1_CH3/CH4), 编码器 (TIM5)
  43:EncoderMotor/encodermotor.c **** MotorControl_t Motor_D = {
  44:EncoderMotor/encodermotor.c ****     .pwm_timo1 = &htim1, 
  45:EncoderMotor/encodermotor.c ****     .pwm_channel1 = TIM_CHANNEL_3,
  46:EncoderMotor/encodermotor.c ****     .pwm_timo2 = &htim1, 
  47:EncoderMotor/encodermotor.c ****     .pwm_channel2 = TIM_CHANNEL_4,
  48:EncoderMotor/encodermotor.c ****     .encoder_tim = &htim5, 
  49:EncoderMotor/encodermotor.c ****     .kp = 0.5f,
  50:EncoderMotor/encodermotor.c ****     .ki = 0.2f,
  51:EncoderMotor/encodermotor.c ****     .kd = 0.05f
  52:EncoderMotor/encodermotor.c **** };
  53:EncoderMotor/encodermotor.c **** 
  54:EncoderMotor/encodermotor.c **** void Motor_Init(MotorControl_t* motor)
  55:EncoderMotor/encodermotor.c **** {
  30              		.loc 1 55 1 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		.loc 1 55 1 is_stmt 0 view .LVU1
  35 0000 10B5     		push	{r4, lr}
  36              	.LCFI0:
  37              		.cfi_def_cfa_offset 8
  38              		.cfi_offset 4, -8
  39              		.cfi_offset 14, -4
  40 0002 0446     		mov	r4, r0
  56:EncoderMotor/encodermotor.c ****     
  57:EncoderMotor/encodermotor.c ****     
  58:EncoderMotor/encodermotor.c ****     HAL_TIM_PWM_Start(motor->pwm_timo1, motor->pwm_channel1);
  41              		.loc 1 58 5 is_stmt 1 view .LVU2
  42 0004 8168     		ldr	r1, [r0, #8]
  43 0006 0068     		ldr	r0, [r0]
  44              	.LVL1:
  45              		.loc 1 58 5 is_stmt 0 view .LVU3
  46 0008 FFF7FEFF 		bl	HAL_TIM_PWM_Start
  47              	.LVL2:
  59:EncoderMotor/encodermotor.c ****     HAL_TIM_PWM_Start(motor->pwm_timo2, motor->pwm_channel2);
  48              		.loc 1 59 5 is_stmt 1 view .LVU4
  49 000c E168     		ldr	r1, [r4, #12]
  50 000e 6068     		ldr	r0, [r4, #4]
  51 0010 FFF7FEFF 		bl	HAL_TIM_PWM_Start
  52              	.LVL3:
  60:EncoderMotor/encodermotor.c **** 
  61:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo1, motor->pwm_channel1, 0);
  53              		.loc 1 61 5 view .LVU5
  54 0014 A368     		ldr	r3, [r4, #8]
ARM GAS  /tmp/ccykVCxp.s 			page 3


  55 0016 53B9     		cbnz	r3, .L2
  56              		.loc 1 61 5 is_stmt 0 discriminator 1 view .LVU6
  57 0018 2368     		ldr	r3, [r4]
  58 001a 1B68     		ldr	r3, [r3]
  59 001c 0022     		movs	r2, #0
  60 001e 5A63     		str	r2, [r3, #52]
  61              	.L3:
  62:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
  62              		.loc 1 62 5 is_stmt 1 view .LVU7
  63 0020 E368     		ldr	r3, [r4, #12]
  64 0022 BBB9     		cbnz	r3, .L6
  65              		.loc 1 62 5 is_stmt 0 discriminator 1 view .LVU8
  66 0024 6368     		ldr	r3, [r4, #4]
  67 0026 1B68     		ldr	r3, [r3]
  68 0028 0022     		movs	r2, #0
  69 002a 5A63     		str	r2, [r3, #52]
  70              	.L1:
  63:EncoderMotor/encodermotor.c **** }
  71              		.loc 1 63 1 view .LVU9
  72 002c 10BD     		pop	{r4, pc}
  73              	.LVL4:
  74              	.L2:
  61:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
  75              		.loc 1 61 5 discriminator 2 view .LVU10
  76 002e 042B     		cmp	r3, #4
  77 0030 06D0     		beq	.L11
  61:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
  78              		.loc 1 61 5 discriminator 4 view .LVU11
  79 0032 082B     		cmp	r3, #8
  80 0034 09D0     		beq	.L12
  61:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
  81              		.loc 1 61 5 discriminator 7 view .LVU12
  82 0036 2368     		ldr	r3, [r4]
  83 0038 1B68     		ldr	r3, [r3]
  84 003a 0022     		movs	r2, #0
  85 003c 1A64     		str	r2, [r3, #64]
  86 003e EFE7     		b	.L3
  87              	.L11:
  61:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
  88              		.loc 1 61 5 discriminator 3 view .LVU13
  89 0040 2368     		ldr	r3, [r4]
  90 0042 1B68     		ldr	r3, [r3]
  91 0044 0022     		movs	r2, #0
  92 0046 9A63     		str	r2, [r3, #56]
  93 0048 EAE7     		b	.L3
  94              	.L12:
  61:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
  95              		.loc 1 61 5 discriminator 6 view .LVU14
  96 004a 2368     		ldr	r3, [r4]
  97 004c 1B68     		ldr	r3, [r3]
  98 004e 0022     		movs	r2, #0
  99 0050 DA63     		str	r2, [r3, #60]
 100 0052 E5E7     		b	.L3
 101              	.L6:
  62:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 102              		.loc 1 62 5 discriminator 2 view .LVU15
 103 0054 042B     		cmp	r3, #4
ARM GAS  /tmp/ccykVCxp.s 			page 4


 104 0056 06D0     		beq	.L13
  62:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 105              		.loc 1 62 5 discriminator 4 view .LVU16
 106 0058 082B     		cmp	r3, #8
 107 005a 09D0     		beq	.L14
  62:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 108              		.loc 1 62 5 discriminator 7 view .LVU17
 109 005c 6368     		ldr	r3, [r4, #4]
 110 005e 1B68     		ldr	r3, [r3]
 111 0060 0022     		movs	r2, #0
 112 0062 1A64     		str	r2, [r3, #64]
 113              		.loc 1 63 1 view .LVU18
 114 0064 E2E7     		b	.L1
 115              	.L13:
  62:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 116              		.loc 1 62 5 discriminator 3 view .LVU19
 117 0066 6368     		ldr	r3, [r4, #4]
 118 0068 1B68     		ldr	r3, [r3]
 119 006a 0022     		movs	r2, #0
 120 006c 9A63     		str	r2, [r3, #56]
 121 006e DDE7     		b	.L1
 122              	.L14:
  62:EncoderMotor/encodermotor.c ****     __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 123              		.loc 1 62 5 discriminator 6 view .LVU20
 124 0070 6368     		ldr	r3, [r4, #4]
 125 0072 1B68     		ldr	r3, [r3]
 126 0074 0022     		movs	r2, #0
 127 0076 DA63     		str	r2, [r3, #60]
 128 0078 D8E7     		b	.L1
 129              		.cfi_endproc
 130              	.LFE134:
 132              		.section	.text.Motor_SetPWM,"ax",%progbits
 133              		.align	1
 134              		.global	Motor_SetPWM
 135              		.syntax unified
 136              		.thumb
 137              		.thumb_func
 139              	Motor_SetPWM:
 140              	.LVL5:
 141              	.LFB135:
  64:EncoderMotor/encodermotor.c **** 
  65:EncoderMotor/encodermotor.c **** 
  66:EncoderMotor/encodermotor.c **** void Motor_SetPWM(MotorControl_t* motor, int16_t duty) {
 142              		.loc 1 66 56 is_stmt 1 view -0
 143              		.cfi_startproc
 144              		@ args = 0, pretend = 0, frame = 0
 145              		@ frame_needed = 0, uses_anonymous_args = 0
 146              		@ link register save eliminated.
  67:EncoderMotor/encodermotor.c ****     uint16_t pwm_val = (duty < 0) ? -duty : duty;
 147              		.loc 1 67 5 view .LVU22
 148              		.loc 1 67 14 is_stmt 0 view .LVU23
 149 0000 81EAE173 		eor	r3, r1, r1, asr #31
 150 0004 A3EBE173 		sub	r3, r3, r1, asr #31
 151 0008 9BB2     		uxth	r3, r3
 152              	.LVL6:
  68:EncoderMotor/encodermotor.c **** 
  69:EncoderMotor/encodermotor.c ****     if (duty < 0) {
ARM GAS  /tmp/ccykVCxp.s 			page 5


 153              		.loc 1 69 5 is_stmt 1 view .LVU24
 154              		.loc 1 69 8 is_stmt 0 view .LVU25
 155 000a 0029     		cmp	r1, #0
 156 000c 0FDB     		blt	.L40
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo1, motor->pwm_channel1, 0);
  71:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
  72:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
 157              		.loc 1 72 12 is_stmt 1 view .LVU26
 158              		.loc 1 72 15 is_stmt 0 view .LVU27
 159 000e 0029     		cmp	r1, #0
 160 0010 5FDD     		ble	.L25
  73:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo1, motor->pwm_channel1, pwm_val);
 161              		.loc 1 73 9 is_stmt 1 view .LVU28
 162 0012 8268     		ldr	r2, [r0, #8]
 163 0014 002A     		cmp	r2, #0
 164 0016 39D1     		bne	.L26
 165              		.loc 1 73 9 is_stmt 0 discriminator 1 view .LVU29
 166 0018 0268     		ldr	r2, [r0]
 167 001a 1268     		ldr	r2, [r2]
 168 001c 5363     		str	r3, [r2, #52]
 169              	.L27:
  74:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 170              		.loc 1 74 9 is_stmt 1 view .LVU30
 171 001e C368     		ldr	r3, [r0, #12]
 172              	.LVL7:
 173              		.loc 1 74 9 is_stmt 0 view .LVU31
 174 0020 002B     		cmp	r3, #0
 175 0022 43D1     		bne	.L30
 176              		.loc 1 74 9 discriminator 1 view .LVU32
 177 0024 4368     		ldr	r3, [r0, #4]
 178 0026 1B68     		ldr	r3, [r3]
 179 0028 0022     		movs	r2, #0
 180 002a 5A63     		str	r2, [r3, #52]
 181 002c 7047     		bx	lr
 182              	.LVL8:
 183              	.L40:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo1, motor->pwm_channel1, 0);
 184              		.loc 1 70 9 is_stmt 1 view .LVU33
 185 002e 8268     		ldr	r2, [r0, #8]
 186 0030 4AB9     		cbnz	r2, .L17
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo1, motor->pwm_channel1, 0);
 187              		.loc 1 70 9 is_stmt 0 discriminator 1 view .LVU34
 188 0032 0268     		ldr	r2, [r0]
 189 0034 1268     		ldr	r2, [r2]
 190 0036 0021     		movs	r1, #0
 191              	.LVL9:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo1, motor->pwm_channel1, 0);
 192              		.loc 1 70 9 discriminator 1 view .LVU35
 193 0038 5163     		str	r1, [r2, #52]
 194              	.L18:
  71:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
 195              		.loc 1 71 9 is_stmt 1 view .LVU36
 196 003a C268     		ldr	r2, [r0, #12]
 197 003c B2B9     		cbnz	r2, .L21
  71:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
 198              		.loc 1 71 9 is_stmt 0 discriminator 1 view .LVU37
 199 003e 4268     		ldr	r2, [r0, #4]
ARM GAS  /tmp/ccykVCxp.s 			page 6


 200 0040 1268     		ldr	r2, [r2]
 201 0042 5363     		str	r3, [r2, #52]
 202 0044 7047     		bx	lr
 203              	.LVL10:
 204              	.L17:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 205              		.loc 1 70 9 discriminator 2 view .LVU38
 206 0046 042A     		cmp	r2, #4
 207 0048 06D0     		beq	.L41
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 208              		.loc 1 70 9 discriminator 4 view .LVU39
 209 004a 082A     		cmp	r2, #8
 210 004c 09D0     		beq	.L42
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 211              		.loc 1 70 9 discriminator 7 view .LVU40
 212 004e 0268     		ldr	r2, [r0]
 213 0050 1268     		ldr	r2, [r2]
 214 0052 0021     		movs	r1, #0
 215              	.LVL11:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 216              		.loc 1 70 9 discriminator 7 view .LVU41
 217 0054 1164     		str	r1, [r2, #64]
 218 0056 F0E7     		b	.L18
 219              	.LVL12:
 220              	.L41:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 221              		.loc 1 70 9 discriminator 3 view .LVU42
 222 0058 0268     		ldr	r2, [r0]
 223 005a 1268     		ldr	r2, [r2]
 224 005c 0021     		movs	r1, #0
 225              	.LVL13:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 226              		.loc 1 70 9 discriminator 3 view .LVU43
 227 005e 9163     		str	r1, [r2, #56]
 228 0060 EBE7     		b	.L18
 229              	.LVL14:
 230              	.L42:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 231              		.loc 1 70 9 discriminator 6 view .LVU44
 232 0062 0268     		ldr	r2, [r0]
 233 0064 1268     		ldr	r2, [r2]
 234 0066 0021     		movs	r1, #0
 235              	.LVL15:
  70:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, pwm_val);
 236              		.loc 1 70 9 discriminator 6 view .LVU45
 237 0068 D163     		str	r1, [r2, #60]
 238 006a E6E7     		b	.L18
 239              	.L21:
  71:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
 240              		.loc 1 71 9 discriminator 2 view .LVU46
 241 006c 042A     		cmp	r2, #4
 242 006e 05D0     		beq	.L43
  71:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
 243              		.loc 1 71 9 discriminator 4 view .LVU47
 244 0070 082A     		cmp	r2, #8
 245 0072 07D0     		beq	.L44
  71:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
ARM GAS  /tmp/ccykVCxp.s 			page 7


 246              		.loc 1 71 9 discriminator 7 view .LVU48
 247 0074 4268     		ldr	r2, [r0, #4]
 248 0076 1268     		ldr	r2, [r2]
 249 0078 1364     		str	r3, [r2, #64]
 250 007a 7047     		bx	lr
 251              	.L43:
  71:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
 252              		.loc 1 71 9 discriminator 3 view .LVU49
 253 007c 4268     		ldr	r2, [r0, #4]
 254 007e 1268     		ldr	r2, [r2]
 255 0080 9363     		str	r3, [r2, #56]
 256 0082 7047     		bx	lr
 257              	.L44:
  71:EncoderMotor/encodermotor.c ****     } else if (duty > 0) {
 258              		.loc 1 71 9 discriminator 6 view .LVU50
 259 0084 4268     		ldr	r2, [r0, #4]
 260 0086 1268     		ldr	r2, [r2]
 261 0088 D363     		str	r3, [r2, #60]
 262 008a 7047     		bx	lr
 263              	.LVL16:
 264              	.L26:
  73:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 265              		.loc 1 73 9 discriminator 2 view .LVU51
 266 008c 042A     		cmp	r2, #4
 267 008e 05D0     		beq	.L45
  73:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 268              		.loc 1 73 9 discriminator 4 view .LVU52
 269 0090 082A     		cmp	r2, #8
 270 0092 07D0     		beq	.L46
  73:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 271              		.loc 1 73 9 discriminator 7 view .LVU53
 272 0094 0268     		ldr	r2, [r0]
 273 0096 1268     		ldr	r2, [r2]
 274 0098 1364     		str	r3, [r2, #64]
 275 009a C0E7     		b	.L27
 276              	.L45:
  73:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 277              		.loc 1 73 9 discriminator 3 view .LVU54
 278 009c 0268     		ldr	r2, [r0]
 279 009e 1268     		ldr	r2, [r2]
 280 00a0 9363     		str	r3, [r2, #56]
 281 00a2 BCE7     		b	.L27
 282              	.L46:
  73:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 283              		.loc 1 73 9 discriminator 6 view .LVU55
 284 00a4 0268     		ldr	r2, [r0]
 285 00a6 1268     		ldr	r2, [r2]
 286 00a8 D363     		str	r3, [r2, #60]
 287 00aa B8E7     		b	.L27
 288              	.LVL17:
 289              	.L30:
 290              		.loc 1 74 9 discriminator 2 view .LVU56
 291 00ac 042B     		cmp	r3, #4
 292 00ae 06D0     		beq	.L47
 293              		.loc 1 74 9 discriminator 4 view .LVU57
 294 00b0 082B     		cmp	r3, #8
 295 00b2 09D0     		beq	.L48
ARM GAS  /tmp/ccykVCxp.s 			page 8


 296              		.loc 1 74 9 discriminator 7 view .LVU58
 297 00b4 4368     		ldr	r3, [r0, #4]
 298 00b6 1B68     		ldr	r3, [r3]
 299 00b8 0022     		movs	r2, #0
 300 00ba 1A64     		str	r2, [r3, #64]
 301 00bc 7047     		bx	lr
 302              	.L47:
 303              		.loc 1 74 9 discriminator 3 view .LVU59
 304 00be 4368     		ldr	r3, [r0, #4]
 305 00c0 1B68     		ldr	r3, [r3]
 306 00c2 0022     		movs	r2, #0
 307 00c4 9A63     		str	r2, [r3, #56]
 308 00c6 7047     		bx	lr
 309              	.L48:
 310              		.loc 1 74 9 discriminator 6 view .LVU60
 311 00c8 4368     		ldr	r3, [r0, #4]
 312 00ca 1B68     		ldr	r3, [r3]
 313 00cc 0022     		movs	r2, #0
 314 00ce DA63     		str	r2, [r3, #60]
 315 00d0 7047     		bx	lr
 316              	.LVL18:
 317              	.L25:
  75:EncoderMotor/encodermotor.c ****     } else {  // duty == 0
  76:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo1, motor->pwm_channel1, 0);
 318              		.loc 1 76 9 is_stmt 1 view .LVU61
 319 00d2 8368     		ldr	r3, [r0, #8]
 320              	.LVL19:
 321              		.loc 1 76 9 is_stmt 0 view .LVU62
 322 00d4 53B9     		cbnz	r3, .L33
 323              		.loc 1 76 9 discriminator 1 view .LVU63
 324 00d6 0368     		ldr	r3, [r0]
 325 00d8 1B68     		ldr	r3, [r3]
 326 00da 0022     		movs	r2, #0
 327 00dc 5A63     		str	r2, [r3, #52]
 328              	.L34:
  77:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 329              		.loc 1 77 9 is_stmt 1 view .LVU64
 330 00de C368     		ldr	r3, [r0, #12]
 331 00e0 BBB9     		cbnz	r3, .L37
 332              		.loc 1 77 9 is_stmt 0 discriminator 1 view .LVU65
 333 00e2 4368     		ldr	r3, [r0, #4]
 334 00e4 1B68     		ldr	r3, [r3]
 335 00e6 0022     		movs	r2, #0
 336 00e8 5A63     		str	r2, [r3, #52]
 337 00ea 7047     		bx	lr
 338              	.L33:
  76:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 339              		.loc 1 76 9 discriminator 2 view .LVU66
 340 00ec 042B     		cmp	r3, #4
 341 00ee 06D0     		beq	.L49
  76:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 342              		.loc 1 76 9 discriminator 4 view .LVU67
 343 00f0 082B     		cmp	r3, #8
 344 00f2 09D0     		beq	.L50
  76:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 345              		.loc 1 76 9 discriminator 7 view .LVU68
 346 00f4 0368     		ldr	r3, [r0]
ARM GAS  /tmp/ccykVCxp.s 			page 9


 347 00f6 1B68     		ldr	r3, [r3]
 348 00f8 0022     		movs	r2, #0
 349 00fa 1A64     		str	r2, [r3, #64]
 350 00fc EFE7     		b	.L34
 351              	.L49:
  76:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 352              		.loc 1 76 9 discriminator 3 view .LVU69
 353 00fe 0368     		ldr	r3, [r0]
 354 0100 1B68     		ldr	r3, [r3]
 355 0102 0022     		movs	r2, #0
 356 0104 9A63     		str	r2, [r3, #56]
 357 0106 EAE7     		b	.L34
 358              	.L50:
  76:EncoderMotor/encodermotor.c ****         __HAL_TIM_SET_COMPARE(motor->pwm_timo2, motor->pwm_channel2, 0);
 359              		.loc 1 76 9 discriminator 6 view .LVU70
 360 0108 0368     		ldr	r3, [r0]
 361 010a 1B68     		ldr	r3, [r3]
 362 010c 0022     		movs	r2, #0
 363 010e DA63     		str	r2, [r3, #60]
 364 0110 E5E7     		b	.L34
 365              	.L37:
 366              		.loc 1 77 9 discriminator 2 view .LVU71
 367 0112 042B     		cmp	r3, #4
 368 0114 06D0     		beq	.L51
 369              		.loc 1 77 9 discriminator 4 view .LVU72
 370 0116 082B     		cmp	r3, #8
 371 0118 09D0     		beq	.L52
 372              		.loc 1 77 9 discriminator 7 view .LVU73
 373 011a 4368     		ldr	r3, [r0, #4]
 374 011c 1B68     		ldr	r3, [r3]
 375 011e 0022     		movs	r2, #0
 376 0120 1A64     		str	r2, [r3, #64]
  78:EncoderMotor/encodermotor.c ****     }
  79:EncoderMotor/encodermotor.c **** }
 377              		.loc 1 79 1 view .LVU74
 378 0122 7047     		bx	lr
 379              	.L51:
  77:EncoderMotor/encodermotor.c ****     }
 380              		.loc 1 77 9 discriminator 3 view .LVU75
 381 0124 4368     		ldr	r3, [r0, #4]
 382 0126 1B68     		ldr	r3, [r3]
 383 0128 0022     		movs	r2, #0
 384 012a 9A63     		str	r2, [r3, #56]
 385 012c 7047     		bx	lr
 386              	.L52:
  77:EncoderMotor/encodermotor.c ****     }
 387              		.loc 1 77 9 discriminator 6 view .LVU76
 388 012e 4368     		ldr	r3, [r0, #4]
 389 0130 1B68     		ldr	r3, [r3]
 390 0132 0022     		movs	r2, #0
 391 0134 DA63     		str	r2, [r3, #60]
 392 0136 7047     		bx	lr
 393              		.cfi_endproc
 394              	.LFE135:
 396              		.section	.text.Motor_Encoder_Init,"ax",%progbits
 397              		.align	1
 398              		.global	Motor_Encoder_Init
ARM GAS  /tmp/ccykVCxp.s 			page 10


 399              		.syntax unified
 400              		.thumb
 401              		.thumb_func
 403              	Motor_Encoder_Init:
 404              	.LVL20:
 405              	.LFB136:
  80:EncoderMotor/encodermotor.c **** 
  81:EncoderMotor/encodermotor.c **** 
  82:EncoderMotor/encodermotor.c **** /*编码器实现*/
  83:EncoderMotor/encodermotor.c **** 
  84:EncoderMotor/encodermotor.c **** void Motor_Encoder_Init(MotorControl_t* motor) {
 406              		.loc 1 84 48 is_stmt 1 view -0
 407              		.cfi_startproc
 408              		@ args = 0, pretend = 0, frame = 0
 409              		@ frame_needed = 0, uses_anonymous_args = 0
 410              		.loc 1 84 48 is_stmt 0 view .LVU78
 411 0000 08B5     		push	{r3, lr}
 412              	.LCFI1:
 413              		.cfi_def_cfa_offset 8
 414              		.cfi_offset 3, -8
 415              		.cfi_offset 14, -4
  85:EncoderMotor/encodermotor.c ****     motor->encoder_last = 0;
 416              		.loc 1 85 5 is_stmt 1 view .LVU79
 417              		.loc 1 85 25 is_stmt 0 view .LVU80
 418 0002 0023     		movs	r3, #0
 419 0004 4361     		str	r3, [r0, #20]
  86:EncoderMotor/encodermotor.c ****     motor->duty_rpm = 0;
 420              		.loc 1 86 5 is_stmt 1 view .LVU81
 421              		.loc 1 86 21 is_stmt 0 view .LVU82
 422 0006 0023     		movs	r3, #0
 423 0008 8361     		str	r3, [r0, #24]	@ float
  87:EncoderMotor/encodermotor.c ****     motor->target_rpm = 0;
 424              		.loc 1 87 5 is_stmt 1 view .LVU83
 425              		.loc 1 87 23 is_stmt 0 view .LVU84
 426 000a C361     		str	r3, [r0, #28]	@ float
  88:EncoderMotor/encodermotor.c ****     motor->pid_integral = 0.0f;
 427              		.loc 1 88 5 is_stmt 1 view .LVU85
 428              		.loc 1 88 25 is_stmt 0 view .LVU86
 429 000c C362     		str	r3, [r0, #44]	@ float
  89:EncoderMotor/encodermotor.c ****     motor->pid_last_error = 0.0f;
 430              		.loc 1 89 5 is_stmt 1 view .LVU87
 431              		.loc 1 89 27 is_stmt 0 view .LVU88
 432 000e 0363     		str	r3, [r0, #48]	@ float
  90:EncoderMotor/encodermotor.c **** 
  91:EncoderMotor/encodermotor.c ****     HAL_TIM_Encoder_Start(motor->encoder_tim, TIM_CHANNEL_ALL);
 433              		.loc 1 91 5 is_stmt 1 view .LVU89
 434 0010 3C21     		movs	r1, #60
 435 0012 0069     		ldr	r0, [r0, #16]
 436              	.LVL21:
 437              		.loc 1 91 5 is_stmt 0 view .LVU90
 438 0014 FFF7FEFF 		bl	HAL_TIM_Encoder_Start
 439              	.LVL22:
  92:EncoderMotor/encodermotor.c ****     HAL_TIM_Base_Start_IT(&htim6);  // ⚠️ 必须调用，否则不会触发中断
 440              		.loc 1 92 5 is_stmt 1 view .LVU91
 441 0018 0148     		ldr	r0, .L55
 442 001a FFF7FEFF 		bl	HAL_TIM_Base_Start_IT
 443              	.LVL23:
ARM GAS  /tmp/ccykVCxp.s 			page 11


  93:EncoderMotor/encodermotor.c **** }
 444              		.loc 1 93 1 is_stmt 0 view .LVU92
 445 001e 08BD     		pop	{r3, pc}
 446              	.L56:
 447              		.align	2
 448              	.L55:
 449 0020 00000000 		.word	htim6
 450              		.cfi_endproc
 451              	.LFE136:
 453              		.section	.text.Motor_Encoder_Read,"ax",%progbits
 454              		.align	1
 455              		.global	Motor_Encoder_Read
 456              		.syntax unified
 457              		.thumb
 458              		.thumb_func
 460              	Motor_Encoder_Read:
 461              	.LVL24:
 462              	.LFB137:
  94:EncoderMotor/encodermotor.c **** 
  95:EncoderMotor/encodermotor.c **** /*读取编码器数值*/
  96:EncoderMotor/encodermotor.c **** int32_t Motor_Encoder_Read(MotorControl_t* motor) {
 463              		.loc 1 96 51 is_stmt 1 view -0
 464              		.cfi_startproc
 465              		@ args = 0, pretend = 0, frame = 0
 466              		@ frame_needed = 0, uses_anonymous_args = 0
 467              		@ link register save eliminated.
  97:EncoderMotor/encodermotor.c ****     int32_t encoder_value = __HAL_TIM_GET_COUNTER(motor->encoder_tim);
 468              		.loc 1 97 5 view .LVU94
 469              		.loc 1 97 29 is_stmt 0 view .LVU95
 470 0000 0369     		ldr	r3, [r0, #16]
 471 0002 1B68     		ldr	r3, [r3]
 472 0004 5A6A     		ldr	r2, [r3, #36]
 473              	.LVL25:
  98:EncoderMotor/encodermotor.c ****     int32_t delta = encoder_value - motor->encoder_last;
 474              		.loc 1 98 5 is_stmt 1 view .LVU96
 475              		.loc 1 98 42 is_stmt 0 view .LVU97
 476 0006 4369     		ldr	r3, [r0, #20]
 477              		.loc 1 98 13 view .LVU98
 478 0008 D31A     		subs	r3, r2, r3
 479              	.LVL26:
  99:EncoderMotor/encodermotor.c ****     motor->encoder_last = encoder_value;
 480              		.loc 1 99 5 is_stmt 1 view .LVU99
 481              		.loc 1 99 25 is_stmt 0 view .LVU100
 482 000a 4261     		str	r2, [r0, #20]
 100:EncoderMotor/encodermotor.c **** 
 101:EncoderMotor/encodermotor.c ****     // 计算当前速度（RPM）
 102:EncoderMotor/encodermotor.c ****     motor->duty_rpm = delta;  // 根据编码器的计数值计算速度
 483              		.loc 1 102 5 is_stmt 1 view .LVU101
 484              		.loc 1 102 21 is_stmt 0 view .LVU102
 485 000c 07EE903A 		vmov	s15, r3	@ int
 486 0010 F8EEE77A 		vcvt.f32.s32	s15, s15
 487 0014 C0ED067A 		vstr.32	s15, [r0, #24]
 103:EncoderMotor/encodermotor.c ****     return motor->duty_rpm;
 488              		.loc 1 103 5 is_stmt 1 view .LVU103
 104:EncoderMotor/encodermotor.c **** }
 489              		.loc 1 104 1 is_stmt 0 view .LVU104
 490 0018 FDEEE77A 		vcvt.s32.f32	s15, s15
ARM GAS  /tmp/ccykVCxp.s 			page 12


 491 001c 17EE900A 		vmov	r0, s15	@ int
 492              	.LVL27:
 493              		.loc 1 104 1 view .LVU105
 494 0020 7047     		bx	lr
 495              		.cfi_endproc
 496              	.LFE137:
 498              		.section	.text.Motor_Encoder_SpeedUpdate,"ax",%progbits
 499              		.align	1
 500              		.global	Motor_Encoder_SpeedUpdate
 501              		.syntax unified
 502              		.thumb
 503              		.thumb_func
 505              	Motor_Encoder_SpeedUpdate:
 506              	.LVL28:
 507              	.LFB138:
 105:EncoderMotor/encodermotor.c **** 
 106:EncoderMotor/encodermotor.c **** 
 107:EncoderMotor/encodermotor.c **** 
 108:EncoderMotor/encodermotor.c **** // 配置参数
 109:EncoderMotor/encodermotor.c **** #define ENCODER_PPR      13       // 编码器原始 PPR
 110:EncoderMotor/encodermotor.c **** #define MULTIPLIER       4        // 倍频数（你现在是 TIM_ENCODERMODE_TI12）
 111:EncoderMotor/encodermotor.c **** #define GEAR_RATIO       20.0f    // 减速比
 112:EncoderMotor/encodermotor.c **** #define SAMPLE_TIME_S    0.1f     // 采样时间，单位秒
 113:EncoderMotor/encodermotor.c **** 
 114:EncoderMotor/encodermotor.c **** void Motor_Encoder_SpeedUpdate(MotorControl_t* motor)
 115:EncoderMotor/encodermotor.c **** {
 508              		.loc 1 115 1 is_stmt 1 view -0
 509              		.cfi_startproc
 510              		@ args = 0, pretend = 0, frame = 0
 511              		@ frame_needed = 0, uses_anonymous_args = 0
 512              		@ link register save eliminated.
 116:EncoderMotor/encodermotor.c ****     uint32_t now = __HAL_TIM_GET_COUNTER(motor->encoder_tim);
 513              		.loc 1 116 5 view .LVU107
 514              		.loc 1 116 20 is_stmt 0 view .LVU108
 515 0000 0369     		ldr	r3, [r0, #16]
 516 0002 1B68     		ldr	r3, [r3]
 517              		.loc 1 116 14 view .LVU109
 518 0004 5A6A     		ldr	r2, [r3, #36]
 519              	.LVL29:
 117:EncoderMotor/encodermotor.c ****     int32_t delta = (int32_t)(now - motor->encoder_last);
 520              		.loc 1 117 5 is_stmt 1 view .LVU110
 521              		.loc 1 117 42 is_stmt 0 view .LVU111
 522 0006 4369     		ldr	r3, [r0, #20]
 523              		.loc 1 117 35 view .LVU112
 524 0008 D31A     		subs	r3, r2, r3
 525              	.LVL30:
 118:EncoderMotor/encodermotor.c ****     motor->encoder_last = now;
 526              		.loc 1 118 5 is_stmt 1 view .LVU113
 527              		.loc 1 118 25 is_stmt 0 view .LVU114
 528 000a 4261     		str	r2, [r0, #20]
 119:EncoderMotor/encodermotor.c **** 
 120:EncoderMotor/encodermotor.c ****     // 一圈多少个计数？
 121:EncoderMotor/encodermotor.c ****     const  float pulses_per_rev = ENCODER_PPR * MULTIPLIER;  // 13 * 4 = 52
 529              		.loc 1 121 5 is_stmt 1 view .LVU115
 530              	.LVL31:
 122:EncoderMotor/encodermotor.c ****     float rpm = (delta / pulses_per_rev) * (60.0f / SAMPLE_TIME_S);  // 电机原轴 RPM
 531              		.loc 1 122 5 view .LVU116
ARM GAS  /tmp/ccykVCxp.s 			page 13


 532              		.loc 1 122 24 is_stmt 0 view .LVU117
 533 000c 07EE903A 		vmov	s15, r3	@ int
 534 0010 F8EEE77A 		vcvt.f32.s32	s15, s15
 535 0014 DFED076A 		vldr.32	s13, .L59
 536 0018 87EEA67A 		vdiv.f32	s14, s15, s13
 537              		.loc 1 122 11 view .LVU118
 538 001c DFED067A 		vldr.32	s15, .L59+4
 539 0020 67EE277A 		vmul.f32	s15, s14, s15
 540              	.LVL32:
 123:EncoderMotor/encodermotor.c **** 
 124:EncoderMotor/encodermotor.c ****     // 如果想要的是减速后的输出轴速度，需除以减速比
 125:EncoderMotor/encodermotor.c ****     motor->duty_rpm = rpm / GEAR_RATIO;
 541              		.loc 1 125 5 is_stmt 1 view .LVU119
 542              		.loc 1 125 27 is_stmt 0 view .LVU120
 543 0024 F3EE046A 		vmov.f32	s13, #2.0e+1
 544 0028 87EEA67A 		vdiv.f32	s14, s15, s13
 545              		.loc 1 125 21 view .LVU121
 546 002c 80ED067A 		vstr.32	s14, [r0, #24]
 126:EncoderMotor/encodermotor.c **** 
 127:EncoderMotor/encodermotor.c ****     // printf("Motor Output RPM: %.3f\r\n", motor->duty_rpm);
 128:EncoderMotor/encodermotor.c **** }
 547              		.loc 1 128 1 view .LVU122
 548 0030 7047     		bx	lr
 549              	.L60:
 550 0032 00BF     		.align	2
 551              	.L59:
 552 0034 00005042 		.word	1112539136
 553 0038 00001644 		.word	1142292480
 554              		.cfi_endproc
 555              	.LFE138:
 557              		.section	.text.Motor_PID_Calculate,"ax",%progbits
 558              		.align	1
 559              		.global	Motor_PID_Calculate
 560              		.syntax unified
 561              		.thumb
 562              		.thumb_func
 564              	Motor_PID_Calculate:
 565              	.LVL33:
 566              	.LFB139:
 129:EncoderMotor/encodermotor.c **** 
 130:EncoderMotor/encodermotor.c **** /*速度pid的实现*/
 131:EncoderMotor/encodermotor.c **** float Motor_PID_Calculate(MotorControl_t* motor, int32_t target_rpm) {
 567              		.loc 1 131 70 is_stmt 1 view -0
 568              		.cfi_startproc
 569              		@ args = 0, pretend = 0, frame = 0
 570              		@ frame_needed = 0, uses_anonymous_args = 0
 571              		@ link register save eliminated.
 572              		.loc 1 131 70 is_stmt 0 view .LVU124
 573 0000 07EE901A 		vmov	s15, r1	@ int
 132:EncoderMotor/encodermotor.c ****     // 计算误差
 133:EncoderMotor/encodermotor.c ****     float error = target_rpm - motor->duty_rpm;
 574              		.loc 1 133 5 is_stmt 1 view .LVU125
 575              		.loc 1 133 30 is_stmt 0 view .LVU126
 576 0004 F8EEE77A 		vcvt.f32.s32	s15, s15
 577              		.loc 1 133 37 view .LVU127
 578 0008 90ED067A 		vldr.32	s14, [r0, #24]
 579              		.loc 1 133 11 view .LVU128
ARM GAS  /tmp/ccykVCxp.s 			page 14


 580 000c 77EEC77A 		vsub.f32	s15, s15, s14
 581              	.LVL34:
 134:EncoderMotor/encodermotor.c **** 
 135:EncoderMotor/encodermotor.c ****     // 积分
 136:EncoderMotor/encodermotor.c ****     motor->pid_integral += error;
 582              		.loc 1 136 5 is_stmt 1 view .LVU129
 583              		.loc 1 136 10 is_stmt 0 view .LVU130
 584 0010 90ED0B7A 		vldr.32	s14, [r0, #44]
 585              		.loc 1 136 25 view .LVU131
 586 0014 37EE277A 		vadd.f32	s14, s14, s15
 587 0018 80ED0B7A 		vstr.32	s14, [r0, #44]
 137:EncoderMotor/encodermotor.c **** 
 138:EncoderMotor/encodermotor.c ****     // 微分
 139:EncoderMotor/encodermotor.c ****     float derivative = error - motor->pid_last_error;
 588              		.loc 1 139 5 is_stmt 1 view .LVU132
 589              		.loc 1 139 37 is_stmt 0 view .LVU133
 590 001c D0ED0C6A 		vldr.32	s13, [r0, #48]
 591              		.loc 1 139 11 view .LVU134
 592 0020 77EEE66A 		vsub.f32	s13, s15, s13
 593              	.LVL35:
 140:EncoderMotor/encodermotor.c ****     motor->pid_last_error = error;
 594              		.loc 1 140 5 is_stmt 1 view .LVU135
 595              		.loc 1 140 27 is_stmt 0 view .LVU136
 596 0024 C0ED0C7A 		vstr.32	s15, [r0, #48]
 141:EncoderMotor/encodermotor.c **** 
 142:EncoderMotor/encodermotor.c ****     // PID输出
 143:EncoderMotor/encodermotor.c ****     float output = (motor->kp * error) + (motor->ki * motor->pid_integral) + (motor->kd * derivativ
 597              		.loc 1 143 5 is_stmt 1 view .LVU137
 598              		.loc 1 143 26 is_stmt 0 view .LVU138
 599 0028 90ED080A 		vldr.32	s0, [r0, #32]
 600              		.loc 1 143 31 view .LVU139
 601 002c 60EE277A 		vmul.f32	s15, s0, s15
 602              	.LVL36:
 603              		.loc 1 143 48 view .LVU140
 604 0030 90ED096A 		vldr.32	s12, [r0, #36]
 605              		.loc 1 143 53 view .LVU141
 606 0034 27EE067A 		vmul.f32	s14, s14, s12
 607              		.loc 1 143 40 view .LVU142
 608 0038 77EE877A 		vadd.f32	s15, s15, s14
 609              		.loc 1 143 84 view .LVU143
 610 003c 90ED0A0A 		vldr.32	s0, [r0, #40]
 611              		.loc 1 143 89 view .LVU144
 612 0040 20EE260A 		vmul.f32	s0, s0, s13
 613              	.LVL37:
 144:EncoderMotor/encodermotor.c **** 
 145:EncoderMotor/encodermotor.c ****     return output;
 614              		.loc 1 145 5 is_stmt 1 view .LVU145
 146:EncoderMotor/encodermotor.c **** }
 615              		.loc 1 146 1 is_stmt 0 view .LVU146
 616 0044 37EE800A 		vadd.f32	s0, s15, s0
 617              	.LVL38:
 618              		.loc 1 146 1 view .LVU147
 619 0048 7047     		bx	lr
 620              		.cfi_endproc
 621              	.LFE139:
 623              		.global	__aeabi_f2d
 624              		.section	.rodata.Motor_PID_Control.str1.4,"aMS",%progbits,1
ARM GAS  /tmp/ccykVCxp.s 			page 15


 625              		.align	2
 626              	.LC0:
 627 0000 54617267 		.ascii	"Target RPM: %.3f, Current RPM: %.3f, PID Output: %."
 627      65742052 
 627      504D3A20 
 627      252E3366 
 627      2C204375 
 628 0033 33662C20 		.ascii	"3f, PWM Duty: %d\015\012\000"
 628      50574D20 
 628      44757479 
 628      3A202564 
 628      0D0A00
 629              		.section	.text.Motor_PID_Control,"ax",%progbits
 630              		.align	1
 631              		.global	Motor_PID_Control
 632              		.syntax unified
 633              		.thumb
 634              		.thumb_func
 636              	Motor_PID_Control:
 637              	.LVL39:
 638              	.LFB140:
 147:EncoderMotor/encodermotor.c **** 
 148:EncoderMotor/encodermotor.c **** /*编码器电机的pid速度控制*/
 149:EncoderMotor/encodermotor.c **** void Motor_PID_Control(MotorControl_t* motor) {
 639              		.loc 1 149 47 is_stmt 1 view -0
 640              		.cfi_startproc
 641              		@ args = 0, pretend = 0, frame = 0
 642              		@ frame_needed = 0, uses_anonymous_args = 0
 643              		.loc 1 149 47 is_stmt 0 view .LVU149
 644 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 645              	.LCFI2:
 646              		.cfi_def_cfa_offset 24
 647              		.cfi_offset 4, -24
 648              		.cfi_offset 5, -20
 649              		.cfi_offset 6, -16
 650              		.cfi_offset 7, -12
 651              		.cfi_offset 8, -8
 652              		.cfi_offset 14, -4
 653 0004 2DED028B 		vpush.64	{d8}
 654              	.LCFI3:
 655              		.cfi_def_cfa_offset 32
 656              		.cfi_offset 80, -32
 657              		.cfi_offset 81, -28
 658 0008 86B0     		sub	sp, sp, #24
 659              	.LCFI4:
 660              		.cfi_def_cfa_offset 56
 661 000a 0446     		mov	r4, r0
 150:EncoderMotor/encodermotor.c ****     // 定期更新编码器速度
 151:EncoderMotor/encodermotor.c ****     Motor_Encoder_SpeedUpdate(motor);
 662              		.loc 1 151 5 is_stmt 1 view .LVU150
 663 000c FFF7FEFF 		bl	Motor_Encoder_SpeedUpdate
 664              	.LVL40:
 152:EncoderMotor/encodermotor.c **** 
 153:EncoderMotor/encodermotor.c ****     // 计算 PID 输出
 154:EncoderMotor/encodermotor.c ****     float pid_output = Motor_PID_Calculate(motor, motor->target_rpm);
 665              		.loc 1 154 5 view .LVU151
 666              		.loc 1 154 56 is_stmt 0 view .LVU152
ARM GAS  /tmp/ccykVCxp.s 			page 16


 667 0010 D4ED077A 		vldr.32	s15, [r4, #28]
 668              		.loc 1 154 24 view .LVU153
 669 0014 FDEEE77A 		vcvt.s32.f32	s15, s15
 670 0018 17EE901A 		vmov	r1, s15	@ int
 671 001c 2046     		mov	r0, r4
 672 001e FFF7FEFF 		bl	Motor_PID_Calculate
 673              	.LVL41:
 674 0022 B0EE408A 		vmov.f32	s16, s0
 675              	.LVL42:
 155:EncoderMotor/encodermotor.c **** 
 156:EncoderMotor/encodermotor.c ****     // 将 PID 输出转换为 PWM 值
 157:EncoderMotor/encodermotor.c ****     int16_t pwm_duty = (int16_t)pid_output;
 676              		.loc 1 157 5 is_stmt 1 view .LVU154
 677              		.loc 1 157 13 is_stmt 0 view .LVU155
 678 0026 FDEEC07A 		vcvt.s32.f32	s15, s0
 679 002a 17EE903A 		vmov	r3, s15	@ int
 680 002e 1DB2     		sxth	r5, r3
 681              	.LVL43:
 158:EncoderMotor/encodermotor.c **** 
 159:EncoderMotor/encodermotor.c ****     // 限制 PWM 范围
 160:EncoderMotor/encodermotor.c ****     if (pwm_duty > 1000) pwm_duty = 1000;  // 假设最大 PWM 值为 1000
 682              		.loc 1 160 5 is_stmt 1 view .LVU156
 683              		.loc 1 160 8 is_stmt 0 view .LVU157
 684 0030 B5F57A7F 		cmp	r5, #1000
 685 0034 04DC     		bgt	.L64
 161:EncoderMotor/encodermotor.c ****     if (pwm_duty < -1000) pwm_duty = -1000;
 686              		.loc 1 161 5 is_stmt 1 view .LVU158
 687              		.loc 1 161 8 is_stmt 0 view .LVU159
 688 0036 15F57A7F 		cmn	r5, #1000
 689 003a 03DA     		bge	.L63
 690              		.loc 1 161 36 discriminator 1 view .LVU160
 691 003c 124D     		ldr	r5, .L67
 692              	.LVL44:
 693              		.loc 1 161 36 discriminator 1 view .LVU161
 694 003e 01E0     		b	.L63
 695              	.LVL45:
 696              	.L64:
 160:EncoderMotor/encodermotor.c ****     if (pwm_duty < -1000) pwm_duty = -1000;
 697              		.loc 1 160 35 discriminator 1 view .LVU162
 698 0040 4FF47A75 		mov	r5, #1000
 699              	.LVL46:
 700              	.L63:
 162:EncoderMotor/encodermotor.c **** 
 163:EncoderMotor/encodermotor.c ****     // 设置 PWM
 164:EncoderMotor/encodermotor.c ****     Motor_SetPWM(motor, pwm_duty);
 701              		.loc 1 164 5 is_stmt 1 view .LVU163
 702 0044 2946     		mov	r1, r5
 703 0046 2046     		mov	r0, r4
 704 0048 FFF7FEFF 		bl	Motor_SetPWM
 705              	.LVL47:
 165:EncoderMotor/encodermotor.c **** 
 166:EncoderMotor/encodermotor.c ****     // 打印调试信息
 167:EncoderMotor/encodermotor.c ****     printf("Target RPM: %.3f, Current RPM: %.3f, PID Output: %.3f, PWM Duty: %d\r\n",
 706              		.loc 1 167 5 view .LVU164
 168:EncoderMotor/encodermotor.c ****            motor->target_rpm, motor->duty_rpm, pid_output, pwm_duty);
 707              		.loc 1 168 36 is_stmt 0 view .LVU165
 708 004c D4F81880 		ldr	r8, [r4, #24]	@ float
ARM GAS  /tmp/ccykVCxp.s 			page 17


 167:EncoderMotor/encodermotor.c ****            motor->target_rpm, motor->duty_rpm, pid_output, pwm_duty);
 709              		.loc 1 167 5 view .LVU166
 710 0050 E069     		ldr	r0, [r4, #28]	@ float
 711 0052 FFF7FEFF 		bl	__aeabi_f2d
 712              	.LVL48:
 713 0056 0646     		mov	r6, r0
 714 0058 0F46     		mov	r7, r1
 715 005a 0495     		str	r5, [sp, #16]
 716 005c 18EE100A 		vmov	r0, s16
 717 0060 FFF7FEFF 		bl	__aeabi_f2d
 718              	.LVL49:
 719 0064 CDE90201 		strd	r0, [sp, #8]
 720 0068 4046     		mov	r0, r8	@ float
 721 006a FFF7FEFF 		bl	__aeabi_f2d
 722              	.LVL50:
 723 006e CDE90001 		strd	r0, [sp]
 724 0072 3246     		mov	r2, r6
 725 0074 3B46     		mov	r3, r7
 726 0076 0548     		ldr	r0, .L67+4
 727 0078 FFF7FEFF 		bl	printf
 728              	.LVL51:
 169:EncoderMotor/encodermotor.c **** }...
 729              		.loc 1 169 1 view .LVU167
 730 007c 06B0     		add	sp, sp, #24
 731              	.LCFI5:
 732              		.cfi_def_cfa_offset 32
 733              		@ sp needed
 734 007e BDEC028B 		vldm	sp!, {d8}
 735              	.LCFI6:
 736              		.cfi_restore 80
 737              		.cfi_restore 81
 738              		.cfi_def_cfa_offset 24
 739              	.LVL52:
 740              		.loc 1 169 1 view .LVU168
 741 0082 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 742              	.LVL53:
 743              	.L68:
 744              		.loc 1 169 1 view .LVU169
 745 0086 00BF     		.align	2
 746              	.L67:
 747 0088 18FCFFFF 		.word	-1000
 748 008c 00000000 		.word	.LC0
 749              		.cfi_endproc
 750              	.LFE140:
 752              		.global	Motor_D
 753              		.section	.data.Motor_D,"aw"
 754              		.align	2
 757              	Motor_D:
 758 0000 00000000 		.word	htim1
 759 0004 00000000 		.word	htim1
 760 0008 08000000 		.word	8
 761 000c 0C000000 		.word	12
 762 0010 00000000 		.word	htim5
 763 0014 00000000 		.space	12
 763      00000000 
 763      00000000 
 764 0020 0000003F 		.word	1056964608
ARM GAS  /tmp/ccykVCxp.s 			page 18


 765 0024 CDCC4C3E 		.word	1045220557
 766 0028 CDCC4C3D 		.word	1028443341
 767 002c 00000000 		.space	8
 767      00000000 
 768              		.global	Motor_C
 769              		.section	.data.Motor_C,"aw"
 770              		.align	2
 773              	Motor_C:
 774 0000 00000000 		.word	htim1
 775 0004 00000000 		.word	htim1
 776 0008 00000000 		.word	0
 777 000c 04000000 		.word	4
 778 0010 00000000 		.word	htim4
 779 0014 00000000 		.space	12
 779      00000000 
 779      00000000 
 780 0020 0000003F 		.word	1056964608
 781 0024 CDCC4C3E 		.word	1045220557
 782 0028 CDCC4C3D 		.word	1028443341
 783 002c 00000000 		.space	8
 783      00000000 
 784              		.global	Motor_B
 785              		.section	.data.Motor_B,"aw"
 786              		.align	2
 789              	Motor_B:
 790 0000 00000000 		.word	htim9
 791 0004 00000000 		.word	htim9
 792 0008 00000000 		.word	0
 793 000c 04000000 		.word	4
 794 0010 00000000 		.word	htim3
 795 0014 00000000 		.space	12
 795      00000000 
 795      00000000 
 796 0020 0000003F 		.word	1056964608
 797 0024 CDCC4C3E 		.word	1045220557
 798 0028 CDCC4C3D 		.word	1028443341
 799 002c 00000000 		.space	8
 799      00000000 
 800              		.global	Motor_A
 801              		.section	.data.Motor_A,"aw"
 802              		.align	2
 805              	Motor_A:
 806 0000 00000000 		.word	htim10
 807 0004 00000000 		.word	htim11
 808 0008 00000000 		.word	0
 809 000c 00000000 		.word	0
 810 0010 00000000 		.word	htim2
 811 0014 00000000 		.space	12
 811      00000000 
 811      00000000 
 812 0020 0000003F 		.word	1056964608
 813 0024 CDCC4C3E 		.word	1045220557
 814 0028 CDCC4C3D 		.word	1028443341
 815 002c 00000000 		.space	8
 815      00000000 
 816              		.text
 817              	.Letext0:
ARM GAS  /tmp/ccykVCxp.s 			page 19


 818              		.file 2 "/usr/lib/gcc/arm-none-eabi/13.2.1/include/stdint.h"
 819              		.file 3 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f407xx.h"
 820              		.file 4 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 821              		.file 5 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 822              		.file 6 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_tim.h"
 823              		.file 7 "Core/Inc/tim.h"
 824              		.file 8 "EncoderMotor/encodermotor.h"
 825              		.file 9 "<built-in>"
ARM GAS  /tmp/ccykVCxp.s 			page 20


DEFINED SYMBOLS
                            *ABS*:00000000 encodermotor.c
     /tmp/ccykVCxp.s:21     .text.Motor_Init:00000000 $t
     /tmp/ccykVCxp.s:27     .text.Motor_Init:00000000 Motor_Init
     /tmp/ccykVCxp.s:133    .text.Motor_SetPWM:00000000 $t
     /tmp/ccykVCxp.s:139    .text.Motor_SetPWM:00000000 Motor_SetPWM
     /tmp/ccykVCxp.s:397    .text.Motor_Encoder_Init:00000000 $t
     /tmp/ccykVCxp.s:403    .text.Motor_Encoder_Init:00000000 Motor_Encoder_Init
     /tmp/ccykVCxp.s:449    .text.Motor_Encoder_Init:00000020 $d
     /tmp/ccykVCxp.s:454    .text.Motor_Encoder_Read:00000000 $t
     /tmp/ccykVCxp.s:460    .text.Motor_Encoder_Read:00000000 Motor_Encoder_Read
     /tmp/ccykVCxp.s:499    .text.Motor_Encoder_SpeedUpdate:00000000 $t
     /tmp/ccykVCxp.s:505    .text.Motor_Encoder_SpeedUpdate:00000000 Motor_Encoder_SpeedUpdate
     /tmp/ccykVCxp.s:552    .text.Motor_Encoder_SpeedUpdate:00000034 $d
     /tmp/ccykVCxp.s:558    .text.Motor_PID_Calculate:00000000 $t
     /tmp/ccykVCxp.s:564    .text.Motor_PID_Calculate:00000000 Motor_PID_Calculate
     /tmp/ccykVCxp.s:625    .rodata.Motor_PID_Control.str1.4:00000000 $d
     /tmp/ccykVCxp.s:630    .text.Motor_PID_Control:00000000 $t
     /tmp/ccykVCxp.s:636    .text.Motor_PID_Control:00000000 Motor_PID_Control
     /tmp/ccykVCxp.s:747    .text.Motor_PID_Control:00000088 $d
     /tmp/ccykVCxp.s:757    .data.Motor_D:00000000 Motor_D
     /tmp/ccykVCxp.s:754    .data.Motor_D:00000000 $d
     /tmp/ccykVCxp.s:773    .data.Motor_C:00000000 Motor_C
     /tmp/ccykVCxp.s:770    .data.Motor_C:00000000 $d
     /tmp/ccykVCxp.s:789    .data.Motor_B:00000000 Motor_B
     /tmp/ccykVCxp.s:786    .data.Motor_B:00000000 $d
     /tmp/ccykVCxp.s:805    .data.Motor_A:00000000 Motor_A
     /tmp/ccykVCxp.s:802    .data.Motor_A:00000000 $d

UNDEFINED SYMBOLS
HAL_TIM_PWM_Start
HAL_TIM_Encoder_Start
HAL_TIM_Base_Start_IT
htim6
__aeabi_f2d
printf
htim1
htim5
htim4
htim9
htim3
htim10
htim11
htim2
